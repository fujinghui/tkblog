function FemyObject(){}

var femy = new FemyObject();
FemyObject.prototype.view_server = null;
FemyObject.prototype.data_server = null;
FemyObject.prototype.filter_a = function(e){
	var $this = this;
	if(!$this.getAttribute("href") || $this.getAttribute("href").length <= 0)
	{
		return;
	}
	if($this.getAttribute("href").substr(0, 7) == "http://")
	{
		//yes default event
		console.log("allow");
		return;
	}

	if(e && e.preventDefault)
		e.preventDefault();
	else
		window.event.returnValue = false;
	//console.log(femy);
	//no href attr! nothing do

	var url = femy.view_server+$this.getAttribute("href");
	window.location.href=url;
	//console.log($this.getAttribute("href")+" the link no skip!");
}


FemyObject.prototype.init = function(param) {
	if(param)
	{
		if(param.view_server)
			this.view_server = param.view_server;
		if(param.data_server)
			this.data_server = param.data_server;
	}
	var $this = this;
	window.onload = function(){
		var as = document.getElementsByTagName("a");
		for(var i = 0; i < as.length; i ++)
			as[i].onclick = $this.filter_a;
	}
	//alert("view:"+this.view_server);
	//alert("data:"+this.data_server);
};

//alert(femy.a);
//js template engine
String.prototype.FTemplate = function(data){
	//if(Array.isArray(data)){
	//}
	var self = this;
	var reg = /{{([^{{]+)}}/g;
	while(a=reg.exec(self))
	{
		//console.log(a);
	}
	return;


	var self = this;
	var html = self.replace(/{{([^{}]+)?}}/g, function(k, v){
		//console.log(k+":"+v);
		if(data[v])
			return data[v];
		return "";
	});
	return html;
}
var fnn = new Function("data", "var r = []; for (var i in data){r.push(data[i])} return r.join('');");
a = fnn({"name":"fujinghui", "age":"20"});
//console.log(a);
var FEngine = function(tpl, data){
	//var reg = /{{([^}]+)}}/g;
	//var reg = /{{([^{{])+}}/g;
	var reg = /{{((?!\{\{)(?!\}\}).)+}}/g;
	var code = "var r=[];\n";
	var cursor = 0;
	var add = function(line, js){
		//version 1.0
		//code += "r.push(\""+line.replace(/"/g, '\\"')+"\");\n";
		
		//version 2.0
		var regOut = /(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g;
		//js?code+=line.match(regOut)?line+'\n':'r.push('+line+');\n':
		//code+='r.push("'+line.replace(/"/g, '\\"')+'");\n';
		//version 2.1.0
		js?(code +=line.match(regOut)?line+'\n':"r.push(fd."+line.replace(/"/g,'\\"')+");\n"):code+="r.push(\""+line.replace(/"/g, '\\"')+"\");\n";
		return add;
	}
	while(match=reg.exec(tpl))
	{
		//console.log(match[0]);
		add(tpl.slice(cursor, match.index))(match[0].slice(2,match[0].length-2), true);
		cursor = match.index + match[0].length;
	}
	add(tpl.substr(cursor, tpl.length - cursor));
	code += 'return r.join("");';
	var a = data;
	var aFun = new Function("fd", code);
	//return new Function("data", code);//.apply({aaa:"ff"});
	return aFun(data);
	//console.log(new Function(code).apply(data));

}


var time = new Date().valueOf();
//console.log("tpl:"+FEngine(tpl, data));
// var rdata = FEngine(tpl, data);
// time = new Date().valueOf()-time;
// console.log("time:"+time);
// console.log("data length:"+rdata.length);
// console.log("data:"+rdata);
// function PPP(a, b, c){
// 	console.log(arguments);

// }
// PPP("fu", "jing", "hui");
// console.log(0.1+0.2);